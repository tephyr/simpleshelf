=============================
simpleshelf: track your books
=============================

simpleshelf stores your personal library of books to read, have read, want to read, and lets you track your progress.

simpleshelf is deliberately designed for simplicity: it tracks enough information for you to identify a book, and to get more information from other sources.  The (envisioned) links to OpenLibrary_, the `Library of Congress`_, and others will provide more detailed information.

Technical details
+++++++++++++++++
simpleshelf is a web application; it stores data in CouchDB_, and presents it with a single page app served by NodeJS_ and written in Backbone.js_.

Tools, libraries, plugins
-------------------------
- NodeJS_
- CouchDB_
- Backbone.js_
- Docker_
- gulp_

How to install
++++++++++++++
Development
-----------
#. Install Docker_ & docker-compose.
#. Install NodeJS_.
#. Install gulp_ globally.
#. Install node dependencies: ``npm install``.
#. Build Docker_ images::

     # Use your Docker Hub ID, or an empty string.
     sudo DOCKER_ACCT=X NODE_ENV=development docker-compose build

#. Run the app::

     sudo DOCKER_ACCT=X NODE_ENV=development docker-compose up

Production
----------
After the ``npm install`` step...

#. Build Docker_  production images::

     # Use your Docker Hub ID, or an empty string.
     sudo DOCKER_ACCT=X NODE_ENV=production docker-compose -f docker-compose.yml -f docker-compose-production.yml build

#. Copy ``./server/config`` to the target directory, retaining the data structure.
#. Copy ``docker-compose*.yml`` to the target directory.
#. **If you intend to run multiple versions**, add a ``container_name`` value to ``docker-compose-production.yml`` for each service, customizing it *for that instance*.
#. In the target directory, pass the initial CouchDB admin name & password to ``couchdb_init.sh``, and run it.
#. Run the app::

     sudo DOCKER_ACCT=X NODE_ENV=production docker-compose -f docker-compose.yml -f docker-compose-production.yml up

#. TODO: **ONE-TIME** To seed CouchDB's initial databases::

   # NOTE: the containers MUST be running, and you MUST be able to access them.
   # sudo DOCKER_ACCT=X NODE_ENV=production docker-compose -f docker-compose.yml -f docker-compose-production.yml exec couchdb sh
   sudo DOCKER_ACCT=X NODE_ENV=production docker-compose -f docker-compose.yml -f docker-compose-production.yml -v $(pwd)/server/setup:/tmp/setup exec couchdb sh

   # Type `exit` and press `ctrl-c` to exit the shell.

Configuration
-------------
Available configuration values are:

- Port to expose
- Volumes to customize

.. **Development version**: assumes the CouchDB instance is at http://127.0.0.1:5984/simpleshelf.

.. 1. Install CouchDB_ v1.6.1 or greater.
.. #. Install node_ (LTS series).
.. #. Install gulp_ globally.
.. #. *Optional*: To test, install PhantomJS_ for your system (or it will be installed by npm in the next step).
.. #. Install node dependencies: ``npm install``.
.. #. Create a database named ``simpleshelf`` in the local CouchDB instance.
.. #. Push current code to your couchdb server: ``gulp bulk-update push``

..    This pushes both the code and the default documents to the local installation; see ``config/default.json``.

.. Done!  simpleshelf is now available for use; load the UI at http://127.0.0.1:5984/simpleshelf/_design/simpleshelfmobile/_rewrite/index.

.. **Ongoing development**:

.. #. Set gulp to watch for changes (``gulp app-watch ddoc-watch docs-watch test-watch``).
.. #. Modify code or documents.
.. #. Reload the design doc.

How to test
-----------
* ``gulp test-phantom``: runs the PhantomJS_ test runner, outputting to the console.
* ``gulp test-in-browser``: runs the BrowserSync runner, launching (or updating) the test page, typically at http://localhost:3000/index.html.
* ``gulp test-watch``: run the console *and* browser tests, reloading both when any code changes.

.. Documentation
.. +++++++++++++
.. Generated by Sphinx_, available in ``docs/``.

.. _backbone.js: http://backbonejs.org/
.. _chai: http://chaijs.com/
.. _couchdb: http://couchdb.apache.org/
.. _docker: https://docker.com/
.. _gulp: http://gulpjs.com/
.. _jquery: http://jquery.com/
.. _`library of congress`: http://www.loc.gov/
.. _mocha: http://mochajs.org/
.. _nodejs: https://nodejs.org/
.. _openlibrary: http://openlibrary.org/
.. _phantomjs: http://phantomjs.org/
.. _python: http://python.org/
.. _sphinx: http://sphinx.pocoo.org/

License
+++++++
`GNU AFFERO GENERAL PUBLIC LICENSE, Version 3 (AGPL-3.0) <http://opensource.org/licenses/AGPL-3.0>`__
